---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const entries = await getCollection("guides");
  return entries.map((entry) => ({ params: { slug: entry.slug } }));
}

const siteName = import.meta.env.PUBLIC_SITE_NAME ?? "PricingNest";
const { slug } = Astro.params as { slug: string };
const entries = await getCollection("guides");
const entry = entries.find((e) => e.slug === slug);
if (!entry) throw new Error(`Unknown guide slug: ${slug}`);

const { Content } = await entry.render();
const title = `${entry.data.title} | ${siteName}`;
---
<BaseLayout title={title} description={entry.data.description}>
  <section class="hero">
    <h1>{entry.data.title}</h1>
    <p>{entry.data.description}</p>
  </section>

  <div class="grid">
    <article class="card col8">
      <Content />
    </article>

    <aside class="card col4">
      <h2>More</h2>
      <ul class="list">
        <li><a href="/guides/">All guides</a></li>
        <li><a href="/saas-pricing/">All calculators</a></li>
        <li><a href="/glossary/">Glossary</a></li>
      </ul>
      {entry.data.updated ? <p class="muted" style="margin-top: 1rem;">Last updated: {entry.data.updated}</p> : null}
    </aside>
  </div>
</BaseLayout>

